<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Plugin Integration - Gluu Docs</title>
      
<link href="../../assets/stylesheets/font.css" rel="stylesheet">
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Gluu Docs">
    <meta property="og:image" content="None/../../gluu.jpg">
    <meta name="apple-mobile-web-app-title" content="Gluu Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../gluu.jpg">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-60feabe0e5.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-60feabe0e5.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-f58e216493.css">
    
    <link rel="stylesheet" href="../../assets/stylesheets/zenburn-28d5b94970.css">
    
      
      
      
      <link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto Sans:400,700|Source+Code+Pro">
      <style>
        body, input {
          font-family: 'Noto Sans', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4a5cc7e01e.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Administration Guide <i class="icon icon-link"></i>
              
            
          </span>
        
        Plugin Integration
      </div>
    </div>
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" placeholder="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">

  
  <a href="https://github.com/GluuFederation/docs" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../gluu.jpg">
        </div>
      
      <div class="name">
        <strong>Gluu Docs</strong><br>
        version: 3.0.0
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      <ul class="repo">
        
        <li class="home">
          <a href="/" title="Home">
            <div class="home-image">
            <i class="fa fa-home"></i> Doc Home</div>
          </a>
        </li>
        
        
        
        <li class="repo-download">
          
          <a href="https://github.com/GluuFederation/docs/archive/3.0.0.zip" target="_blank" title="Download" data-action="download">
            <i class="icon icon-download"></i> Download
          </a>
        </li>
        
      </ul>
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>
                  
          
            
  <li>
    <span class="section">Installation Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Preparing VM" href="../../installation-guide/">
      Preparing VM
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Install Gluu Server" href="../../installation-guide/install/">
      Install Gluu Server
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Setup Script Options" href="../../installation-guide/setup_py/">
      Setup Script Options
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Cluster with CE" href="../../installation-guide/cluster/">
      Cluster with CE
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Upgrade/Patch Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Upgrade Gluu Server" href="../../upgrade/">
      Upgrade Gluu Server
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Patch Gluu Server" href="../../upgrade/update/">
      Patch Gluu Server
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Administration Guide</span>
    <ul>
      
        
  <li>
<<<<<<< HEAD
    <a class="" title="Administrating Gluu oxTrust UI" href="../">
      Administrating Gluu oxTrust UI
=======
    <a class="" title="Gluu Server UI" href="../">
      Gluu Server UI
>>>>>>> 161b5dc7faa3ba94045c37badf83d2dcfd5ed474
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Authentication Protocols" href="../auth-protocol/">
      Authentication Protocols
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Authentication Management" href="../auth-management/">
      Authentication Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Configuring Multi-Factor Authentication" href="../multi-factor-auth/">
      Configuring Multi-Factor Authentication
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Manage & Configure Users" href="../user-group/">
      Manage & Configure Users
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Log Management" href="../logs/">
      Log Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Configure and Manage OpenID Clients" href="../clients/">
      Configure and Manage OpenID Clients
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Configure and Manage SAML SSO" href="../saml/">
      Configure and Manage SAML SSO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OAuth2 Grants" href="../oauth2/">
      OAuth2 Grants
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenID Connect" href="../openid-connect/">
      OpenID Connect
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="UMA" href="../uma/">
      UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Attribute Management" href="../attribute/">
      Attribute Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM protected by UMA" href="../scim-uma/">
      SCIM protected by UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Gluu Server APIs" href="../api/">
      Gluu Server APIs
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM API Configuration" href="../scim/">
      SCIM API Configuration
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Service Integration in Gluu CE" href="../integrate/">
      Service Integration in Gluu CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="current" title="Plugin Integration" href="./">
      Plugin Integration
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Documentation" href="#documentation">
                <b>Documentation</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="OpenID Connect RP in CentOS" href="#openid-connect-rp-in-centos">
                <b>OpenID Connect RP in CentOS</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Basic Web Server Installation" href="#basic-web-server-installation">
                  <font size=2><i>Basic Web Server Installation</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Apache Web Server" href="#apache-web-server">
                  <font size=2><i>Apache Web Server</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="SSL Configuration" href="#ssl-configuration">
                  <font size=2><i>SSL Configuration</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="Configuration of mod_auth_openidc" href="#configuration-of-mod_auth_openidc">
                <b>Configuration of mod_auth_openidc</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Installation" href="#installation">
                  <font size=2><i>Installation</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Client Registration" href="#client-registration">
                  <font size=2><i>Client Registration</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Install CGI script" href="#install-cgi-script">
                  <font size=2><i>Install CGI script</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Configuring the Apache VirtualHost" href="#configuring-the-apache-virtualhost">
                  <font size=2><i>Configuring the Apache VirtualHost</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="OpenID Connect RP in CentOS" href="#openid-connect-rp-in-centos_1">
                <b>OpenID Connect RP in CentOS</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Installation" href="#installation_1">
                  <font size=2><i>Installation</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Add EPEL Repository" href="#add-epel-repository">
                  <font size=2><i>Add EPEL Repository</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Apache Web Server" href="#apache-web-server_1">
                  <font size=2><i>Apache Web Server</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Configure SSL Module" href="#configure-ssl-module">
                  <font size=2><i>Configure SSL Module</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Authentication Module (mod_auth_openidc)" href="#authentication-module-mod_auth_openidc">
                  <font size=2><i>Authentication Module (mod_auth_openidc)</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Load Authentication Module" href="#load-authentication-module">
                  <font size=2><i>Load Authentication Module</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="Client Registration" href="#client-registration_1">
                <b>Client Registration</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Dynamic Client Registration" href="#dynamic-client-registration">
                  <font size=2><i>Dynamic Client Registration</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Manual Client Registration" href="#manual-client-registration">
                  <font size=2><i>Manual Client Registration</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="oxRay" href="#oxray">
                <b>oxRay</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Overview" href="#overview">
                  <font size=2><i>Overview</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Deployment" href="#deployment">
                  <font size=2><i>Deployment</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Deploying WAR file using Maven" href="#deploying-war-file-using-maven">
                  <font size=2><i>Deploying WAR file using Maven</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="OpenID Connect Authentication Java" href="#openid-connect-authentication-java">
                <b>OpenID Connect Authentication Java</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Using OpenID Connect to authenticate a person in Java" href="#using-openid-connect-to-authenticate-a-person-in-java">
                  <font size=2><i>Using OpenID Connect to authenticate a person in Java</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Discovery" href="#discovery">
                  <font size=2><i>Discovery</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Client Registration" href="#client-registration_3">
                  <font size=2><i>Client Registration</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Obtaining the id_token" href="#obtaining-the-id_token">
                  <font size=2><i>Obtaining the id_token</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Logout" href="#logout">
                  <font size=2><i>Logout</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="Using OpenID Connect from JavaScript" href="#using-openid-connect-from-javascript">
                <b>Using OpenID Connect from JavaScript</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Apache SAML" href="#apache-saml">
                <b>Apache SAML</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Configuring Apache Shibboleth SP in CentOS" href="#configuring-apache-shibboleth-sp-in-centos">
                  <font size=2><i>Configuring Apache Shibboleth SP in CentOS</i></font>
              </a>
            </li>
             
          
        </ul>
      
    
  </li>
                  
      
        
  <li>
    <a class="" title="Backup Gluu Server CE" href="../backup/">
      Backup Gluu Server CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Custom Script in Gluu CE" href="../custom-script/">
      Custom Script in Gluu CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Certificate Management" href="../certificate/">
      Certificate Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Fine Tuning Gluu Server" href="../fine-tuning/">
      Fine Tuning Gluu Server
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Troubleshooting & FAQ" href="../faq/">
      Troubleshooting & FAQ
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="oxd">OXD<a class="headerlink" href="#oxd" title="Permanent link">#</a></h1>
<p>oxd is a mediator, a service demon that listens on localhost, providing easy APIs that can be called by a web application to simplify using an external OAuth2 server for authentication or authorization. oxd is not a proxy--sometimes it makes API calls on behalf of an application, but other times it just forms the right URLs and returns them to the application. </p>
<p>One significant advantage of using oxd over a native client library is that oxd consolidates the OAuth2 code in one package. If there are updates to the OAuth2 client code, you can update the oxd-server package, without changing the interface to the application.</p>
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">#</a></h2>
<p>The complete documentation for oxd is made available in a separate address. Please see <a href="https://gluu.org/docs-oxd/">this link</a> for the OXD documentation.</p>
<h2 id="openid-connect-rp-in-centos">OpenID Connect RP in CentOS<a class="headerlink" href="#openid-connect-rp-in-centos" title="Permanent link">#</a></h2>
<h3 id="basic-web-server-installation">Basic Web Server Installation<a class="headerlink" href="#basic-web-server-installation" title="Permanent link">#</a></h3>
<p>Before you can install mod_auth_openidc, you need to have an Apache
HTTPD server running with SSL enabled. </p>
<h3 id="apache-web-server">Apache Web Server<a class="headerlink" href="#apache-web-server" title="Permanent link">#</a></h3>
<p>It is assumed that all the hostnames will be dns resolvable. If not, 
then add the entries in <code>/etc/hosts</code> file on both the web server
and Gluu Server. </p>
<p>If you don't have the Apache HTTPD server installed, use apt-get
to install the Ubuntu standard distribution:</p>
<pre><code class="text"># apt-get install apache2
# service apache2 start
</code></pre>

<h3 id="ssl-configuration">SSL Configuration<a class="headerlink" href="#ssl-configuration" title="Permanent link">#</a></h3>
<p>The SSL Module is necessary for the Apache OpenID Connect Module. Please 
use the following commands to activate the <code>ssl module</code>.</p>
<pre><code class="text"># a2enmod ssl
</code></pre>

<p>The next step is to create a self-signed SSL Certificate.</p>
<ul>
<li>Create a directory to put the generate the ssl certificate</li>
</ul>
<pre><code class="text"># mkdir /etc/apache2/ssl`
# openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt
</code></pre>

<ul>
<li>Answer the questions that are asked. A template is given below</li>
</ul>
<pre><code class="text">    Country Name (2 letter code) [AU]:US
    State or Province Name (full name) [Some-State]:TX
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:Acme Inc.
    Organizational Unit Name (eg, section) []:
    Common Name (e.g. server FQDN or YOUR name) []:www.mydomain.com
    Email Address []:help@mydomain.com
</code></pre>

<h4 id="configure-apache-to-use-ssl">Configure Apache to use SSL<a class="headerlink" href="#configure-apache-to-use-ssl" title="Permanent link">#</a></h4>
<p>This section will guide you through the steps to configure apache to 
use the SSL module</p>
<ol>
<li>Open the <code>default-ssl.conf</code> file</li>
</ol>
<pre><code class="text"># vim /etc/apache2/sites-available/default-ssl.conf`

</code></pre>

<ol>
<li>
<p>Update the certificate locations with the newly created certificates 
<code>/etc/apache2/ssl/apache.key</code> and <code>/etc/apache2/ssl/apache.crt</code></p>
</li>
<li>
<p>Activate the SSL Virtual Host and CGI</p>
</li>
</ol>
<pre><code class="text"># a2ensite default-ssl.conf
# a2enmod cgid
# service apache2 restart

</code></pre>

<p>At this point, its a good time to test to make sure SSL and CGI are 
working. Point your browser at 
https://www.mydomain.com/cgi-bin/printHeaders.cgi
You should see a list of current environment variables. </p>
<h2 id="configuration-of-mod_auth_openidc">Configuration of mod_auth_openidc<a class="headerlink" href="#configuration-of-mod_auth_openidc" title="Permanent link">#</a></h2>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">#</a></h3>
<p><code>mod_auth_openidc</code> module depends on the Ubuntu package <code>libjansson4</code>: </p>
<pre><code class="text"># apt-get install libjansson

</code></pre>

<p>You'll also need the mod_auth_openidc and libjose packages which can 
be downloaded from the <a href="https://github.com/pingidentity/mod_auth_openidc/releases">Releases Page</a>.</p>
<p>For example, at this time the current release is 2.1.3, so the command would be:</p>
<pre><code class="text"># wget https://github.com/pingidentity/mod_auth_openidc/releases/download/v2.1.3/libcjose_0.4.1-1ubuntu1.trusty.1_amd64.deb
# wget https://github.com/pingidentity/mod_auth_openidc/releases/download/v2.1.3/libapache2-mod-auth-openidc_2.1.3-1ubuntu1.trusty.1_amd64.deb
# dpkg -i libcjose_0.4.1-1ubuntu1.trusty.1_amd64.deb
# dpkg -i libapache2-mod-auth-openidc_2.1.3-1ubuntu1.trusty.1_amd64.deb

</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Get the latest packages here: https://github.com/pingidentity/mod_auth_openidc/releases</p>
</div>
<p>Note, if you like to build from source, you can clone the project at <a href="https://github.com/pingidentity/mod_auth_openidc">Github Page</a></p>
<p>Now you can enable the module</p>
<pre><code class="text"># sudo a2enmod auth_openidc
# sudo service apache2 restart

</code></pre>

<h3 id="client-registration">Client Registration<a class="headerlink" href="#client-registration" title="Permanent link">#</a></h3>
<p>There are two methods for client registration:</p>
<ol>
<li>Dynamic Client Registration</li>
<li>Manual Client Registration</li>
</ol>
<p>For this example, let's create the client manually in the Gluu Server.
When you add the client, use the following parameters:</p>
<pre><code class="text">Name: mod_auth_openidc
Client Secret: something-sufficiently-unguessable
Application Type: Web
Pre-Authorization: Enabled
login uri: https://www.mydomain.com/callback
Subject Type: Public
Scopes: openid, profile, email
Response Types: code

</code></pre>

<p>Make a note of the <code>client_secret</code> (you won't get to see it again)! You'll
also need the <code>client_id</code> for the next step.</p>
<h3 id="install-cgi-script">Install CGI script<a class="headerlink" href="#install-cgi-script" title="Permanent link">#</a></h3>
<p>This cgi-script makes for a good test page! </p>
<pre><code class="text"># vi /usr/lib/cgi-bin/printHeaders.cgi

</code></pre>

<p>Then paste in this code</p>
<pre><code class="python">#!/usr/bin/python

import os

d = os.environ
k = d.keys()
k.sort()

print &quot;Content-type: text/html\n\n&quot;

print &quot;&lt;HTML&gt;&lt;Head&gt;&lt;TITLE&gt;Print Env Variables&lt;/TITLE&gt;&lt;/Head&gt;&lt;BODY&gt;&quot;
print &quot;&lt;h1&gt;Environment Variables&lt;/H1&gt;&quot;
for item in k:
    print &quot;&lt;p&gt;&lt;B&gt;%s&lt;/B&gt;: %s &lt;/p&gt;&quot; % (item, d[item])
print &quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;

</code></pre>

<p>Then you'll need to make the script executable by the Apache2</p>
<pre><code class="text"># chown www-data:www-data /usr/lib/cgi-bin/printHeaders.cgi
# chmod ug+x /usr/lib/cgi-bin/printHeaders.cgi

</code></pre>

<h3 id="configuring-the-apache-virtualhost">Configuring the Apache VirtualHost<a class="headerlink" href="#configuring-the-apache-virtualhost" title="Permanent link">#</a></h3>
<p>You are almost done! You'll need to configure mod_auth_openidc to
protect your server.</p>
<pre><code class="text"># vi /etc/apache2/sites-available/default-ssl.conf

</code></pre>

<p>Add the following right under <code>&lt;VirtualHost _default_:443&gt;</code></p>
<pre><code class="apacheconf">OIDCProviderMetadataURL https://idp.mydomain.com/.well-known/openid-configuration
OIDCClientID (client-id-you-got-back-when-you-added-the-client)
OIDCClientSecret (your-client-secret)
OIDCRedirectURI https://www.mydomain.com/callback
OIDCResponseType code
OIDCScope &quot;openid profile email&quot;
OIDCSSLValidateServer Off
OIDCCryptoPassphrase (a-random-seed-value)
OIDCPassClaimsAs environment
OIDCClaimPrefix USERINFO_
OIDCPassIDTokenAs payload
&lt;Location &quot;/&quot;&gt;
    Require valid-user
    AuthType openid-connect
&lt;/Location&gt;

</code></pre>

<p>Then restart Apache to effect the changes</p>
<pre><code class="text"># service apache2 restart

</code></pre>

<p>The most confusing part here is the <code>OIDCRedirectURI</code>--don't set this
to a path used by your server. The apache-filter uses the redirect_uri 
to process the response from the OpenID Provider (Gluu Server). </p>
<p>Now you're ready to test. Open your web browser, and point it at 
<code>https://www.mydomain.com/cgi-bin/printHeaders.py</code> </p>
<p>If you're not logged in already, you should be redirected to 
the authentication page. If you are logged in, you should just see
an html page with the <code>REMOTE_USER</code> variable populated. Also
check out the <code>OIDC_id_token_payload</code> and all the claims for 
<code>USERINFO_</code> </p>
<h2 id="openid-connect-rp-in-centos_1">OpenID Connect RP in CentOS<a class="headerlink" href="#openid-connect-rp-in-centos_1" title="Permanent link">#</a></h2>
<h3 id="installation_1">Installation<a class="headerlink" href="#installation_1" title="Permanent link">#</a></h3>
<p>We assume that all the hostnames will be dns resolvable. If not, then
add the according entries in <code>/etc/hosts</code>, please.</p>
<h3 id="add-epel-repository">Add EPEL Repository<a class="headerlink" href="#add-epel-repository" title="Permanent link">#</a></h3>
<p>Run the following command to <strong>Add EPEL Repo</strong>.</p>
<ul>
<li><code>rpm -ivh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code></li>
</ul>
<h3 id="apache-web-server_1">Apache Web Server<a class="headerlink" href="#apache-web-server_1" title="Permanent link">#</a></h3>
<p>To setup <strong>Apache2 SSL</strong>, run the following commands:</p>
<pre><code>yum install httpd mod_ssl
yum install curl hiredis jansson
</code></pre>

<h3 id="configure-ssl-module">Configure SSL Module<a class="headerlink" href="#configure-ssl-module" title="Permanent link">#</a></h3>
<p>This section will guide you to create SSL certificates.
Use the following commands to crete a  directory and generate the certificates.</p>
<pre><code>mkdir /etc/httpd/ssl
openssl req -new -x509 -sha256 -days 365 -nodes -out /etc/httpd/ssl/httpd.pem -keyout /etc/httpd/ssl/httpd.key
</code></pre>

<p>You will be prompted to enter some values such as company name, country etc. Please enter them and your certificate will be ready.</p>
<p>The next step is to configure Apache to use the certificates and use the following command to edit the vhost.conf file.</p>
<pre><code>vi /etc/httpd/conf.d/vhost.conf
</code></pre>

<p>The important part of the configuration is to enter the path to the created SSL certificates. The example is given below.<br/>
<strong>Note:</strong> Please make sure to use the correct server name in the configuration file.</p>
<pre><code>    SSLCertificateFile /etc/httpd/ssl/httpd.pem
    SSLCertificateKeyFile /etc/httpd/ssl/httpd.key
    ServerAdmin support@gluu.org
    ServerName gluu.org
</code></pre>

<p>Restart Apache Server and you are done configuring the SSL Module. Use the command below to restart the Apache Server.</p>
<pre><code>service httpd restart
</code></pre>

<h3 id="authentication-module-mod_auth_openidc">Authentication Module (mod_auth_openidc)<a class="headerlink" href="#authentication-module-mod_auth_openidc" title="Permanent link">#</a></h3>
<p>Run the following command to install the <code>mod_auth_openidc</code> module:</p>
<pre><code>rpm -ivh https://github.com/pingidentity/mod_auth_openidc/releases/download/v1.8.2/mod_auth_openidc-1.8.2-1.el6.x86_64.rpm
</code></pre>

<p><strong>Note:</strong> If there are any difficulties installing <code>hiredis</code> and <code>jansson</code>,
try to update the package database of your system using the following command:</p>
<pre><code>yum upgrade
</code></pre>

<h3 id="load-authentication-module">Load Authentication Module<a class="headerlink" href="#load-authentication-module" title="Permanent link">#</a></h3>
<p>Please make sure that the following shared-object file exists by running the following command:</p>
<pre><code>ls -l /usr/lib64/httpd/modules/mod_auth_openidc.so
</code></pre>

<p>Next, create an <strong>Apache <em>conf</em></strong> file for loading this module.</p>
<pre><code>echo -e &quot;LoadModule auth_openidc_module modules/mod_auth_openidc.so\nListen 44443&quot; &gt; /etc/httpd/conf.d/mod_auth_openidc.conf
</code></pre>

<p>The file <code>/etc/httpd/conf.d/mod_auth_openidc.conf</code> will now contain
these two lines:</p>
<pre><code>LoadModule auth_openidc_module modules/mod_auth_openidc.so
Listen 44443
</code></pre>

<p>This Apache mod should now be listening on port <strong>44443</strong>. To enable
this, start the Apache service (running gluuCE at <strong>ce.gluu.org</strong>):</p>
<pre><code>service httpd start
</code></pre>

<h2 id="client-registration_1">Client Registration<a class="headerlink" href="#client-registration_1" title="Permanent link">#</a></h2>
<p>There are two methods for client registration:</p>
<ol>
<li>Dynamic Client Registration</li>
<li>Manual Client Registration</li>
</ol>
<p>You can use any of the methods to register the client.</p>
<h3 id="dynamic-client-registration">Dynamic Client Registration<a class="headerlink" href="#dynamic-client-registration" title="Permanent link">#</a></h3>
<p>For dynamic client registration, we'll name the server: <strong>dynamic.gluu.org.</strong></p>
<p>Create a directory named <code>dynamic</code> inside the directory <code>/var/www/html</code>, that is:</p>
<pre><code>mkdir /var/www/html/dynamic
</code></pre>

<p>Now, create a file named <code>index.html</code>, and add the following content:</p>
<pre><code>&lt;html&gt;
    &lt;title&gt;
        Protected URL
    &lt;/title&gt;
    &lt;body&gt;
        Nice to see the protected url via Dynamic Registration
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Create another directory named <code>metadata</code> inside the directory from
above to hold further metadata. Then, change the ownership of this
directory using this command:</p>
<pre><code>chown -R apache:apache /var/www/html
</code></pre>

<p>Let's create the Apache configuration file now. Create a file named
<code>/etc/httpd/conf.d/dynamic.conf</code> with the content as below:</p>
<pre><code>&lt;VirtualHost *:44443&gt;
    ServerName dynamic.gluu.org
    DocumentRoot /var/www/html

    OIDCMetadataDir /var/www/html/metadata
    OIDCClientSecret secret

    OIDCRedirectURI https://dynamic.gluu.org:44443/dynamic/fake_redirect_uri
    OIDCCryptoPassphrase secret
    OIDCSSLValidateServer Off

    &lt;Location /dynamic/&gt;
        AuthType openid-connect
        Require valid-user
    &lt;/Location&gt;

    SSLEngine On
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
&lt;/VirtualHost&gt;
</code></pre>

<p>Here, both certificate and key files already exist on the server. You
can use your own, too. Next, enable the site by running the
following command, and restart the Apache service as:</p>
<pre><code>ln -s /etc/httpd/sites-available/dynamic.conf
service httpd restart
</code></pre>

<p>Now, try to access <a href="https://dynamic.gluu.org:44443/dynamic">this page</a>,
and you'll be presented with a discovery page. To access this page,
enter <code>admin@ce.gluu.org</code>.</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/dynamic_discovery.png" /></p>
<p>The usual choice as per present used uris is: <code>admin@ce.gluu.org</code>. Note
that you have to use an existing user at the gluuCE along with an
existing uri. An example is <code>existing_user@your.gluu.ce.server</code>.</p>
<p>After this the <em>oxAuth</em> page from gluuCE is displayed where you enter
the credentials for authentication.</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/oxauth_authentication.png" /></p>
<h3 id="manual-client-registration">Manual Client Registration<a class="headerlink" href="#manual-client-registration" title="Permanent link">#</a></h3>
<p>Considering the <strong>manual client registration</strong> case, we will name the
server <code>static.gluu.org</code>, instead.</p>
<p>Create a directory named <code>/var/www/html/static</code>, i. e. with this
command:</p>
<pre><code>mkdir /var/www/html/static
</code></pre>

<p>Now, let's create another file named <code>index.html</code> with this content:</p>
<pre><code>&lt;html&gt;
    &lt;title&gt;
        Protected URL
    &lt;/title&gt;
    &lt;body&gt;
        Nice to see the protected url via Manual registration
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Then, change the ownerships by using this command:</p>
<pre><code>chown -R apache:apache /var/www/html
</code></pre>

<p>Create a file named <code>/etc/httpd/conf.d/static.conf</code> with the contents as
below:</p>
<pre><code>&lt;VirtualHost *:44443&gt;
    ServerName static.gluu.org
    DocumentRoot /var/www/html

    OIDCRedirectURI https://static.gluu.org:44443/static/fake_redirect_uri
    OIDCCryptoPassphrase newsecret

    OIDCProviderMetadataURL https://ce.gluu.org/.well-known/openid-configuration
    OIDCClientID @!C648.9803.5565.E5CB!0001!0DB0.EEDB!0008!7728.5650
    OIDCClientSecret newsecret
    OIDCResponseType id_token
    OIDCProviderTokenEndpointAuth client_secret_basic

    OIDCProviderIssuer  https://ce.gluu.org
    OIDCSSLValidateServer Off

    &lt;Location /static/&gt;
        AuthType openid-connect
        Require valid-user
    &lt;/Location&gt;

    SSLEngine On
    SSLCertificateFile /etc/httpd/ssl/httpd.pem
    SSLCertificateKeyFile /etc/httpd/ssl/httpd.key
&lt;/VirtualHost&gt;
</code></pre>

<p>Instead of pre-existing cert and key files, feel free to use your own.
Next, enable the static site by running the following command, and
restart the Apache service as below:</p>
<pre><code>ln -s /etc/httpd/sites-available/sites-available/static.conf
service httpd restart
</code></pre>

<p>Now, try to access <a href="https://static.gluu.org:44443/static">this page</a>,
and you should see the oxAuth page from gluuCE where you enter the
credentials for authentication.</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/oxauth_authentication.png" /></p>
<p>Chances are there that you'll see this error after logging in: </p>
<pre><code>Error:

The OpenID Connect Provider returned an error: Error in handling response type.
</code></pre>

<p>The according Apache log looks like that:</p>
<pre><code>[Fri Jun 05 14:48:28 2015] [error] [client 124.253.60.123] oidc_proto_validate_idtoken: id_token JSON payload did not contain the required-by-spec &quot;sub&quot; string value, referer: https://static.gluu.org:44443/static/fake_redirect_uri
[Fri Jun 05 14:48:28 2015] [error] [client 124.253.60.123] oidc_proto_parse_idtoken: id_token payload could not be validated, aborting, referer: https://static.gluu.org:44443/static/fake_redirect_uri
</code></pre>

<p>To solve this problem, log into the gluuCE server by running the
following command:</p>
<pre><code>service gluu-server login
</code></pre>

<h4 id="getting-dn-from-client-id">Getting DN from Client ID<a class="headerlink" href="#getting-dn-from-client-id" title="Permanent link">#</a></h4>
<p>We get the client id from the search performed in Gluu Server's Web UI.
So, to get the DN part we perform the below command. The LDAP password
can be stored in <code>/root/.pw</code> or at any other location that is convenient
for you. In our case the command is:</p>
<pre><code>/opt/opendj/bin/ldapsearch -T -X -Z -p 1636 -D &quot;cn=Directory Manager&quot; -j /root/.pw -s sub -b &quot;o=gluu&quot; 'inum=@!C648.9803.5565.E5CB!0001!0DB0.EEDB!0008!7728.5650'
</code></pre>

<p>Create a file named <code>mod.ldif</code> with the contents given below. The DN
part to be used in <code>mod.ldif</code> is obtained from output of the command
above:</p>
<pre><code>dn: inum=@!C648.9803.5565.E5CB!0001!0DB0.EEDB!0008!7728.5650,ou=clients,o=@!C648.9803.5565.E5CB!0001!0DB0.EEDB,o=gluu
changetype: modify
add: oxAuthSubjectIdentifier
oxAuthSubjectIdentifier: @!C648.9803.5565.E5CB!0001!0DB0.EEDB!0008!7728.5650
</code></pre>

<p>Then, run the <code>ldapmodify</code> command to insert the
<strong>oxAuthSubjectIdentifier</strong> as below:</p>
<pre><code>/opt/opendj/bin/ldapmodify -Z -X -h localhost -p 1636 -D &quot;cn=Directory Manager&quot; -j /root/.pw -f /root/mod.ldif
</code></pre>

<p>The command may vary depending upon your installation. Next, access
<a href="https://static.gluu.org:44443/static">this page</a> or <code>&lt;hostname&gt;:4443/static</code>, and the success
message should be visible.</p>
<h2 id="oxray">oxRay<a class="headerlink" href="#oxray" title="Permanent link">#</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Liferay" title="LifeRay, Wikipedia">LifeRay</a> OpenID Connect plugin to authenticate users using Gluu IdP.</p>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h3>
<p>The oxAuth LifeRay plugin is used to authenticate and auto-log users
from Gluu Server into <a href="https://en.wikipedia.org/wiki/Liferay" title="LifeRay, Wikipedia">LifeRay</a> with the same credentials. It
is built on top of oxAuth, the OpenID Connect provider by Gluu.</p>
<p>The oxAuth plugin intercepts any attempt to login from anywhere in the
LifeRay and redirects the request and the user to an oxAuth server where
the identification takes place, actually. If the user has authorized the
server to share some of his basic information with the oxAuth plugin,
the user will be redirected back to the LifeRay CMS, and logged in,
automatically.</p>
<p>The goal of this project is to use the LifeRay CMS as the basis for an
organizational personal data store service.</p>
<p>Note: This plugin does not support auto-user creation from information
supplied by the oxAuth Plugin. Instead, it can be implemented by
extending the plugin.</p>
<h3 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">#</a></h3>
<p>The plugin is provided in two variants--<a href="https://en.wikipedia.org/wiki/Apache_Maven" title="Apache Maven, Wikipedia">Maven</a> and <a href="https://en.wikipedia.org/wiki/Apache_Ant" title="Apache Ant, Wikipedia">Ant</a>.
You can either use Maven or the LifeRay plugin SDK to build and deploy
this plugin as a standard LifeRay hot deployable WAR file.</p>
<h3 id="deploying-war-file-using-maven">Deploying WAR file using Maven<a class="headerlink" href="#deploying-war-file-using-maven" title="Permanent link">#</a></h3>
<p>This requires a prerequisite: make sure that you have <a href="https://en.wikipedia.org/wiki/Apache_Maven" title="Apache Maven, Wikipedia">Maven</a>
installed on your system to build this plugin from source.</p>
<ol>
<li>
<p>Checkout the Maven source from the [oxRay Repository][https://github.com/GluuFederation/oxRay/tree/master/6.2.x/maven/gluu-openid-connect-hook].</p>
</li>
<li>
<p>Open the file <code>pom.xml</code> in <code>gluu-openid-connect-hook</code>, and update
your local LifeRay Tomcat bundle path. This is required for building the
WAR file and deploying to the LifeRay Tomcat bundle.</p>
</li>
</ol>
<p><img alt="configure_pom_xml" src="../../img/admin-guide/plugin/configure_pom_xml.jpg" /></p>
<ol>
<li>Run the following command in the <code>gluu/6.2.x/maven/gluu-openid-connect-hook</code> 
directory:</li>
</ol>
<pre><code>mvn clean install package liferay:deploy
</code></pre>

<p>This will take a few seconds to download the dependency <code>jar</code> files, and
generate the LifeRay-compiled deployable WAR file. It will be placed
within your <code>&lt;liferay-bundle-folder&gt;/deploy</code> directory, and the hot
deployable process will start.</p>
<h4 id="using-liferay-plugin-sdk-with-ant">Using LifeRay Plugin SDK With Ant<a class="headerlink" href="#using-liferay-plugin-sdk-with-ant" title="Permanent link">#</a></h4>
<p>This requires a prerequisite: we assume that you have the plugin SDK
both installed and configured with LifeRay bundle.</p>
<ol>
<li>
<p>Checkout the gluu-openid-connect-hook plugin source from the
repository, and place these files in your local directory for the plugin
SDK. Usually, this is <code>liferay-plugins-sdk-6.2.0-ce-ga1/hooks</code>.</p>
</li>
<li>
<p>Run the following command in the folder <code>liferay-plugins-sdk-6.2.0-ce-ga1/hooks/gluu-openid-connect-hook</code>:</p>
</li>
</ol>
<pre><code>ant clean deploy
</code></pre>

<h4 id="using-binary-from-repository">Using Binary From Repository<a class="headerlink" href="#using-binary-from-repository" title="Permanent link">#</a></h4>
<p>You can also download a compiled binary as a standard LifeRay deployable
WAR file from the following location:</p>
<p><a href="https://github.com/GluuFederation/oxRay/blob/master/6.2.x/binary/gluu-openid-connect-hook-6.2.0.1.war">oxRay LifeRay Deployable War File</a></p>
<p>Copy this WAR file in your LifeRay bundle. Usually, this is located at
<code>liferay-portal-6.2.0-ce-ga1/deploy</code>.</p>
<p>Once the plugin is deployed as a WAR file either using Maven or Ant, you
will see the following success message in your LifeRay Tomcat server:</p>
<p><img alt="deploy_success" src="../../img/admin-guide/plugin/deploy_success.jpg" /></p>
<h4 id="client-registration_2">Client Registration<a class="headerlink" href="#client-registration_2" title="Permanent link">#</a></h4>
<p>A LifeRay application needs to be registered with the Authorization
server before initiating an authentication request/response with OAuth
IdP server.</p>
<p>The following steps are necessary to obtain both a client id and a
client secret. These data will be used within the LifeRay portal
properties.</p>
<ol>
<li>Go to the location <code>https://seed.gluu.org/oxauth-rp/home.seam</code>.</li>
<li>You will see the Dynamic Client Registration Section.</li>
<li>Enter the Registration Endpoint uri, for example
<code>https://idp.example.org/oxauth/seam/resource/restv1/oxauth/authorize</code>.<ul>
<li>You can derive this uri from your IdP auto-discovery uri which is
like that: <code>https://&lt;Your IDP Server Domain&gt;/.well-known/openid-configuration</code>.</li>
<li>You can search for the registration endpoint, and copy that uri here.</li>
</ul>
</li>
<li>Enter the redirect uris as <code>http://localhost:8080/openidconnect/callback</code>:<ul>
<li>Replace your domain name with <code>localhost:8080</code></li>
<li>This will be your LifeRay handler for logging a user into LifeRay,
automatically, when a redirect comes back from the OAuth server.</li>
</ul>
</li>
<li>Select the Response Types: CODE</li>
<li>Select the Application Type: WEB</li>
<li>For development purposes use: NATIVE (if you are testing on a local
machine with <code>localhost:8080</code> domain)</li>
<li>Enter Client Name: LifeRay App (you can choose any name here).</li>
<li>All other options can be left as they are--please see the attached
screenshot:</li>
</ol>
<p><img alt="client_registration" src="../../img/admin-guide/plugin/dynamic_client_registration_screen1.jpg" /></p>
<ol>
<li>Click <code>Submit</code>, and both the following <code>Registration Request</code> and
<code>Registration Response</code> will be displayed:</li>
</ol>
<p><img alt="json-request-response" src="../../img/admin-guide/plugin/json-request-response.jpg" /></p>
<ol>
<li>Save the Registration Response to your local system. The parameters
<code>client_id</code> and <code>client_secret</code> are used in LifeRay when configuring
<code>portal-ext.properties</code>.</li>
</ol>
<h5 id="modifying-portalproperties">Modifying portal.properties<a class="headerlink" href="#modifying-portalproperties" title="Permanent link">#</a></h5>
<p>It is necessary to modify <code>portal-ext.properties</code> file to reflect oxAuth
server client credentials and server's URL. It can be accomplished by
navigating into the <code>liferay-portal-6.2.0-ce-ga1</code> folder, where the file
<code>portal-ext.properties</code> is stored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To either activate or deactivate the oxAuth plugin put the value</p>
</div>
<p><code>true</code> (to activate) or <code>false</code> (to deactivate), respectively.</p>
<pre><code>gluu.openidconnect.auth.enabled=true
</code></pre>

<ul>
<li>oxAuth client ID and client secret:</li>
</ul>
<pre><code>gluu.openidconnect.client.id=@!1111!0008!51CE.1E59
gluu.openidconnect.client.secret=65777eb7-87a8-4d60-9dbc-d31d43971f2b
</code></pre>

<ul>
<li>OAuth server domain</li>
</ul>
<pre><code>gluu.openidconnect.idp.domain=https://idp.gluu.org`
</code></pre>

<ul>
<li>OAuth server auto discovery uri</li>
</ul>
<pre><code>gluu.openidconnect.url.discovery=https://idp.gluu.org/.well-known/openid-configuration
</code></pre>

<ul>
<li>Your OAuth server logout uri (typically, this will be used to logout a
user from OAuth when a user logs out from LifeRay)</li>
</ul>
<pre><code>gluu.openidconnect.idp.logout=https://idp.gluu.org/identity/logout
</code></pre>

<ul>
<li>LifeRay server callback uri that will be used as a handling response
by the OAuth server after authentication:</li>
<li>replace the <code>localhost:8080</code> with your LifeRay domain name:</li>
</ul>
<pre><code>gluu.openidconnect.client.redirect.url=http://localhost:8080/openidconnect/callback
</code></pre>

<pre><code> This page will be invoked when the user does not exist in the
 LifeRay database, but gets authenticated from the OAuth Server.
</code></pre>
<ul>
<li>Typically, create a LifeRay page with the name <code>/no-such-user-found</code>,
  or redirect to the LifeRay registration page uri like that:</li>
</ul>
<pre><code>gluu.openidconnect.no.such.user.redirect.url=http://localhost:8080/no-such-user-found
</code></pre>

<p>Restart the LifeRay server after editing the file
<code>portal-ext.properties</code>.</p>
<h4 id="login-using-the-liferay-front-end">Login Using the LifeRay Front End<a class="headerlink" href="#login-using-the-liferay-front-end" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Server Bootup</p>
<ul>
<li>Once the LifeRay server is restarted, open your browser and
  navigate to the uri <code>http://localhost:8080</code>.</li>
</ul>
</li>
<li>
<p>Login uri</p>
<ul>
<li>Once the LifeRay page successfully loaded navigate to the OpenID
  connect page at <code>http://localhost:8080/openidconnect/login</code>.</li>
</ul>
</li>
</ul>
<p>Note: you can edit the theme code, and link to the login uri as
<code>http://localhost:8080/openidconnect/login</code>. In result the user will
always redirect to the OAuth server for authentication.</p>
<ul>
<li>OAuth authentication<ul>
<li>The LifeRay login uri will redirect users to the OAuth IdP server
  for user authentication. Internally, passing the oAuth client id 
  as the following screen:</li>
</ul>
</li>
</ul>
<p><img alt="oauth-login" src="../../img/admin-guide/plugin/oauth_login.jpg" /></p>
<ul>
<li>Request for permission<ul>
<li>This screen can be configured depending upon your OAuth Server
  implementation.</li>
</ul>
</li>
</ul>
<p><img alt="oauth_info_confirm" src="../../img/admin-guide/plugin/oauth_info_confirm.jpg" /></p>
<ul>
<li>OAuth callback (user auto-login to LifeRay)<ul>
<li>After a successful authentication with the OAuth server, IdP will
send a callback to LifeRay with a specific code as a parameter:</li>
</ul>
</li>
</ul>
<pre><code>http://localhost:8080/openidconnect/callback?code=xxx`
</code></pre>

<p>This will be intercepted by our oxAuth LifeRay plugin. Upon validation
of the token with the Gluu IdP, it will result in a login of the user to
the LifeRay. The user will be redirected to his respective start page.</p>
<p><img alt="liferay_success_login" src="../../img/admin-guide/plugin/liferay_success_login.jpg" /></p>
<h2 id="openid-connect-authentication-java">OpenID Connect Authentication Java<a class="headerlink" href="#openid-connect-authentication-java" title="Permanent link">#</a></h2>
<h3 id="using-openid-connect-to-authenticate-a-person-in-java">Using OpenID Connect to authenticate a person in Java<a class="headerlink" href="#using-openid-connect-to-authenticate-a-person-in-java" title="Permanent link">#</a></h3>
<p>The <a href="https://openid.net/connect/">OpenID Connect</a> Protocol offers Java
developers a way to authenticate a person at any Internet domain that
supports the standard. To accomplish this, the domain must provide a way
to register clients--the website and mobile applications that use the
authentication API offered by the domain.</p>
<h3 id="discovery">Discovery<a class="headerlink" href="#discovery" title="Permanent link">#</a></h3>
<p>Discovery is the first step! Luckily, its super-easy! All you have to 
do is make a get request to
<code>https://{domain}/.well-known/openid-configuration</code>.</p>
<p>This will return a JSON object, as described in the
<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">specification</a>.
For example, you can see Gluu's OpenID Connect discovery
<a href="https://idp.gluu.org/.well-known/openid-configuration">url</a>.</p>
<p>This will tell you everything you need to know about this OpenID Connect
provider, like what are the endpoints (URLs), what crypto is supported,
and what user claims can you ask for.</p>
<p>An <a href="https://github.com/GluuFederation/oxAuth/blob/master/RP/src/main/java/org/xdi/oxauth/action/OpenIdConnectDiscoveryAction.java">example</a>
of a Discovery Request, using the oxAuth RP library.</p>
<h3 id="client-registration_3">Client Registration<a class="headerlink" href="#client-registration_3" title="Permanent link">#</a></h3>
<p>In SAML, the website was called a "Service Provider." In OpenID Connect,
the website (or mobile application) is called a "Client". Clients can be
registered manually by the OP, but more frequently, clients use the
<a href="http://openid.net/specs/openid-connect-registration-1_0.html">Dynamic Registration
API</a> to
automate the process.</p>
<h3 id="obtaining-the-id_token">Obtaining the id_token<a class="headerlink" href="#obtaining-the-id_token" title="Permanent link">#</a></h3>
<p>After your client is registered, it is time to get down to business.
OpenID Connect offers two common workflows for authentication: basic
(where the person is using a browser, and can be re-directed) and
implicit where the client sends the credentials, including the secret.
There is a useful implements guide for
<a href="http://openid.net/specs/openid-connect-basic-1_0.html">basic</a> and
<a href="http://openid.net/specs/openid-connect-implicit-1_0.html">implicit</a>.</p>
<h3 id="logout">Logout<a class="headerlink" href="#logout" title="Permanent link">#</a></h3>
<p>OpenID Connect defines a mechanism for <a href="http://openid.net/specs/openid-connect-session-1_0.html">Session
Management</a>.
The idea is that JavaScript in a web tab can detect that another tab has
logged out. One detection of a logout event, the Web application can
cleanup sessions in any backend systems as necessary. It is not 100%
effective. If the tab is closed when the logout occurs in another tab,
the event may not be detected, and the backend systems are advised to
timeout sessions.</p>
<h2 id="using-openid-connect-from-javascript">Using OpenID Connect from JavaScript<a class="headerlink" href="#using-openid-connect-from-javascript" title="Permanent link">#</a></h2>
<p>See <a href="http://www.gluu.co/.qqh2">OpenID Connect plugin for Passport</a> for further details.</p>
<h2 id="apache-saml">Apache SAML<a class="headerlink" href="#apache-saml" title="Permanent link">#</a></h2>
<h3 id="configuring-apache-shibboleth-sp-in-centos">Configuring Apache Shibboleth SP in CentOS<a class="headerlink" href="#configuring-apache-shibboleth-sp-in-centos" title="Permanent link">#</a></h3>
<h4 id="system-preparation">System Preparation<a class="headerlink" href="#system-preparation" title="Permanent link">#</a></h4>
<p><strong>Add Shibboleth repository for CentOS</strong></p>
<ul>
<li>The file <code>shib.repo</code> contains the following entry:</li>
</ul>
<pre><code>[security_shibboleth]
name=Shibboleth (CentOS_CentOS-6)
type=rpm-md
baseurl=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/
gpgcheck=1
gpgkey=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/repodata/repomd.xml.key
enabled=1
</code></pre>

<ul>
<li>Download the Shibboleth security repo key from here:</li>
</ul>
<pre><code>http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/security:shibboleth.repo
</code></pre>

<h4 id="shibboleth-sp-installation">Shibboleth SP Installation<a class="headerlink" href="#shibboleth-sp-installation" title="Permanent link">#</a></h4>
<p>To install the Shibboleth SP, run the following commands in a terminal:</p>
<pre><code># yum install shibboleth
# service shibd start
# chkconfig shibd on
</code></pre>

<h1 id="install-and-configure-httpd">Install and Configure httpd<a class="headerlink" href="#install-and-configure-httpd" title="Permanent link">#</a></h1>
<h2 id="installation_2">Installation<a class="headerlink" href="#installation_2" title="Permanent link">#</a></h2>
<p>The following commands will both install, and start the Apache web
server on your machine/Linux environment:</p>
<pre><code># yum install httpd
# service httpd start
# service iptables stop 
</code></pre>

<h4 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">#</a></h4>
<p>Edit the file <code>httpd.conf</code>, and do the following changes:</p>
<ul>
<li>
<p>Change the <code>ServerName</code> directive to the server name of the SP.</p>
</li>
<li>
<p>Set <code>UseCanonicalName On</code>.</p>
</li>
<li>
<p>Restart the httpd service using the command <code>service httpd restart</code>.</p>
</li>
</ul>
<h4 id="httpd-testing">Httpd Testing<a class="headerlink" href="#httpd-testing" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Create an <code>index.html</code> file inside the directory <code>/var/www/html</code>.</p>
</li>
<li>
<p>Restart the httpd service using the command <code>service httpd restart</code>.</p>
</li>
<li>
<p>Check from your browser if the file <code>index.html</code> is visible.</p>
</li>
</ul>
<h4 id="sp-key-certificate">SP Key Certificate<a class="headerlink" href="#sp-key-certificate" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Create both a private key, and a certificate, and place those in the
  file <code>/etc/shibboleth</code>.</p>
</li>
<li>
<p>Change the permissions of these files so that the web server can read
  the files.</p>
</li>
</ul>
<h3 id="shibboleth-sp-configuration">Shibboleth SP Configuration<a class="headerlink" href="#shibboleth-sp-configuration" title="Permanent link">#</a></h3>
<p>This section describes how to configure the file <code>shibboleth2.xml</code>.</p>
<ul>
<li>
<p>Provide the <code>entityID</code> of the according SP in:</p>
<ul>
<li><code>&lt;ApplicationDefaults entityID="http://sp.example.org/Shibboleth"&gt; section</code></li>
</ul>
</li>
<li>
<p>Provide the <code>entityID</code> of the IdP in:</p>
<ul>
<li><code>&lt;SSO entityID="https://idp.gluu.org/idp/shibboleth"&gt; section</code></li>
</ul>
</li>
<li>
<p>Adjust the entry of the metadata provider. In most cases this is the
  Gluu IdP metadata link:</p>
<ul>
<li><code>&lt;MetadataProvider type="XML" uri="https://idp.gluu.org/idp/shibboleth"&gt; section</code></li>
</ul>
</li>
<li>
<p>Provide both the key and certificate of the SP in:</p>
<ul>
<li><code>&lt;CredentialResolver type="File" key="spkey.key" certificate="spcrt.crt"&gt; section</code></li>
</ul>
</li>
</ul>
<h3 id="shibboleth-manual-configuration-one-physical-sp">Shibboleth Manual Configuration (one Physical SP):<a class="headerlink" href="#shibboleth-manual-configuration-one-physical-sp" title="Permanent link">#</a></h3>
<ul>
<li>
<p>Create a directory named under <code>/var/www/secure</code>.</p>
</li>
<li>
<p>Change the permissions for that directory <code>secure</code> to
  <code>apache:apache</code> (owner and group of the web server).</p>
</li>
<li>
<p><code>httpd.conf</code></p>
<ul>
<li>
<p>change the ServerName <code>&lt;hostname_of_server&gt;</code></p>
</li>
<li>
<p>Define the Location, and the authorization type:</p>
<p><code>&lt;Location /secure&gt;
    AuthType shibboleth
    ShibRequestSetting requireSession 1
    ShibUseHeaders on
    Require valid-user
&lt;/Location&gt;</code></p>
</li>
</ul>
</li>
<li>
<p>configure <code>shibboleth2.xml</code></p>
<ul>
<li>
<p>Set the EntityID of the SP: <code>ApplicationDefaults entityID="http://hostname/secure"</code></p>
</li>
<li>
<p>Provide the EntityID of the IDP: <code>SSO entityID="https://idp.gluu.org/idp/shibboleth"</code></p>
</li>
<li>
<p>Set both the Metadata Provider, and the IDP: <code>MetadataProvider type="XML" uri="https://idp.gluu.org/idp/shibboleth"</code></p>
</li>
</ul>
</li>
<li>
<p>Restart both shibd and Apache2 using these lines:</p>
</li>
</ul>
<pre><code>service shibd restart
service httpd restart
</code></pre>

<ul>
<li>Create a Trust Relationship for this SP in your desired IdP.</li>
</ul>
<h2 id="super-quick-ubuntu-shib-apache-install">Super Quick Ubuntu Shib Apache Install<a class="headerlink" href="#super-quick-ubuntu-shib-apache-install" title="Permanent link">#</a></h2>
<p>Need to protect a test Apache folder using SAML on an Ubuntu server?
Hate to read? This article is for you. Replace both <code>minnow</code> and
<code>minnow.gluu.info</code> with your desired website hostname.</p>
<h3 id="configure-apache">Configure Apache<a class="headerlink" href="#configure-apache" title="Permanent link">#</a></h3>
<p>These are the steps to configure your Apache webserver properly:</p>
<pre><code># apt-get install apache2 libshibsp6 libapache2-mod-shib2
# a2enmod cgi
# a2enmod ssl
# a2enmod shib2
# a2ensite default-ssl
# mkdir /etc/certs
# cd /etc/certs
# openssl genrsa -des3 -out minnow.key 2048
# openssl rsa -in minnow.key -out minnow.key.insecure
# mv minnow.key.insecure minnow.key
# openssl req -new -key minnow.key -out minnow.csr
# openssl x509 -req -days 365 -in minnow.csr -signkey minnow.key -out minnow.crt
# shib-metagen -c /etc/certs/minnow.crt -h minnow.gluu.info &gt; /etc/shibboleth/minnow-metadata.xml
# service apache2 start
# service shibd start
</code></pre>

<p>Download <code>minnow-metadata.xml</code> to your machine. You will need this file
later when you create the Trust Relationship in the Gluu Server.</p>
<pre><code># mkdir /var/www/protected
# touch /var/www/protected/printHeaders.py
# chmod ugo+x /var/www/protected/printHeaders.py
</code></pre>

<p>Edit <code>printHeaders.py</code>, and add this simple script. It will show you the
HTTP headers:</p>
<pre><code>#!/usr/bin/python

import os

d = os.environ
k = d.keys()
k.sort()

print &quot;Content-type: text/html\n\n&quot;

print &quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Print Env Variables&lt;/TITLE&gt;&lt;/Head&gt;&lt;BODY&gt;&quot;
print &quot;&lt;h1&gt;Environment Variables&lt;/H1&gt;&quot;
for item in k:
    print &quot;&lt;p&gt;&lt;B&gt;%s&lt;/B&gt;: %s &lt;/p&gt;&quot; % (item, d[item])
print &quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;
</code></pre>

<p>Edit the default site at <code>/etc/apache2/sites-available/default-ssl.conf</code>, 
and add this part:</p>
<pre><code>ScriptAlias /protected/ /var/www/protected/
&lt;Directory /var/www/protected&gt;
    AddHandler cgi-script .py
    Options +ExecCGI
    SSLOptions +StdEnvVars
    AuthType shibboleth
    ShibRequestSetting requireSession 1
    Require valid-user
&lt;/Directory&gt;
</code></pre>

<h2 id="configure-the-shibboleth-sp">Configure the Shibboleth SP<a class="headerlink" href="#configure-the-shibboleth-sp" title="Permanent link">#</a></h2>
<p>Use this for <code>shibboleth2.xml</code> and replace <code>squid.gluu.info</code> with the
hostname of your SP, and <code>albacore.gluu.info</code> with the hostname of your
IDP.</p>
<pre><code>&lt;SPConfig xmlns=&quot;urn:mace:shibboleth:2.0:native:sp:config&quot;
    xmlns:conf=&quot;urn:mace:shibboleth:2.0:native:sp:config&quot;
    xmlns:saml=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;
    xmlns:samlp=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;    
    xmlns:md=&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;
    logger=&quot;syslog.logger&quot; clockSkew=&quot;180&quot;&gt;
    &lt;OutOfProcess logger=&quot;shibd.logger&quot;&gt;&lt;/OutOfProcess&gt;
    &lt;UnixListener address=&quot;shibd.sock&quot;/&gt;
    &lt;StorageService type=&quot;Memory&quot; id=&quot;mem&quot; cleanupInterval=&quot;900&quot;/&gt;
    &lt;SessionCache type=&quot;StorageService&quot; StorageService=&quot;mem&quot; cacheAssertions=&quot;false&quot;
                  cacheAllowance=&quot;900&quot; inprocTimeout=&quot;900&quot; cleanupInterval=&quot;900&quot;/&gt;
    &lt;ReplayCache StorageService=&quot;mem&quot;/&gt;
    &lt;RequestMapper type=&quot;Native&quot;&gt;
        &lt;RequestMap&gt;
            &lt;Host name=&quot;squid.gluu.info&quot;&gt;
                &lt;Path name=&quot;protected&quot; authType=&quot;shibboleth&quot; requireSession=&quot;true&quot;/&gt;
            &lt;/Host&gt;
        &lt;/RequestMap&gt;
    &lt;/RequestMapper&gt;
    &lt;ApplicationDefaults entityID=&quot;https://squid.gluu.info/shibboleth&quot;
                         REMOTE_USER=&quot;uid&quot;
                         metadataAttributePrefix=&quot;Meta-&quot;
                         sessionHook=&quot;/Shibboleth.sso/AttrChecker&quot;
                         signing=&quot;false&quot; encryption=&quot;false&quot;&gt;

        &lt;Sessions lifetime=&quot;28800&quot; timeout=&quot;3600&quot; checkAddress=&quot;true&quot;
            handlerURL=&quot;/Shibboleth.sso&quot; handlerSSL=&quot;true&quot; cookieProps=&quot;https&quot; relayState=&quot;ss:mem&quot;&gt;

            &lt;SessionInitiator type=&quot;Chaining&quot; Location=&quot;/Login&quot; isDefault=&quot;true&quot; id=&quot;Login&quot;
                              entityID=&quot;https://albacore.gluu.info/idp/shibboleth&quot;&gt;
                &lt;SessionInitiator type=&quot;SAML2&quot; template=&quot;bindingTemplate.html&quot;/&gt;
            &lt;/SessionInitiator&gt;

            &lt;md:AssertionConsumerService Location=&quot;/SAML2/POST-SimpleSign&quot; index=&quot;2&quot;
                Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST-SimpleSign&quot;/&gt;
            &lt;md:AssertionConsumerService Location=&quot;/SAML2/POST&quot; index=&quot;1&quot;
                Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;/&gt;

            &lt;LogoutInitiator type=&quot;Chaining&quot; Location=&quot;/Logout&quot;&gt;
                &lt;LogoutInitiator type=&quot;SAML2&quot; template=&quot;bindingTemplate.html&quot;/&gt;
                &lt;LogoutInitiator type=&quot;Local&quot;/&gt;
            &lt;/LogoutInitiator&gt;

            &lt;md:SingleLogoutService Location=&quot;/SLO/Redirect&quot; conf:template=&quot;bindingTemplate.html&quot;
                Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;/&gt;
            &lt;md:SingleLogoutService Location=&quot;/SLO/POST&quot; conf:template=&quot;bindingTemplate.html&quot;
                Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;/&gt;

            &lt;Handler type=&quot;Status&quot; Location=&quot;/Status&quot;/&gt;
            &lt;Handler type=&quot;Session&quot; Location=&quot;/Session&quot; showAttributeValues=&quot;false&quot;/&gt;
            &lt;Handler type=&quot;AttributeChecker&quot; Location=&quot;/AttrChecker&quot; template=&quot;attrChecker.html&quot;
                attributes=&quot;uid&quot; flushSession=&quot;true&quot;/&gt;
        &lt;/Sessions&gt;

        &lt;Errors supportContact=&quot;root@localhost&quot;
            helpLocation=&quot;/about.html&quot;
            styleSheet=&quot;/shibboleth-sp/main.css&quot;/&gt;

        &lt;MetadataProvider type=&quot;XML&quot; file=&quot;albacore.xml&quot;/&gt;
        &lt;TrustEngine type=&quot;ExplicitKey&quot;/&gt;
        &lt;TrustEngine type=&quot;PKIX&quot;/&gt;
        &lt;AttributeExtractor type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;attribute-map.xml&quot;/&gt;
        &lt;AttributeExtractor type=&quot;Metadata&quot; errorURL=&quot;errorURL&quot; DisplayName=&quot;displayName&quot;/&gt;
        &lt;AttributeResolver type=&quot;Query&quot; subjectMatch=&quot;true&quot;/&gt;
        &lt;AttributeFilter type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;attribute-policy.xml&quot;/&gt;
        &lt;CredentialResolver type=&quot;File&quot; key=&quot;/etc/certs/squid.key&quot; certificate=&quot;/etc/certs/squid.crt&quot;/&gt;
    &lt;/ApplicationDefaults&gt;
    &lt;SecurityPolicyProvider type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;security-policy.xml&quot;/&gt;
    &lt;ProtocolProvider type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;protocols.xml&quot;/&gt;

&lt;/SPConfig&gt;
</code></pre>

<p>Copy this file into <code>/etc/shibboleth/attribute-map.xml</code>:</p>
<pre><code>
&lt;Attributes xmlns=&quot;urn:mace:shibboleth:2.0:attribute-map&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
    &lt;Attribute name=&quot;urn:oid:2.5.4.42&quot; id=&quot;givenName&quot;/&gt;
    &lt;Attribute name=&quot;urn:oid:2.5.4.4&quot; id=&quot;sn&quot;/&gt;
    &lt;Attribute name=&quot;urn:oid:2.16.840.1.113730.3.1.241&quot; id=&quot;displayName&quot;/&gt;
    &lt;Attribute name=&quot;urn:oid:0.9.2342.19200300.100.1.1&quot; id=&quot;uid&quot;/&gt;
&lt;/Attributes&gt;
</code></pre>

<p>Now you need to create a Trust Relationship in your Gluu Server. Login,
go to SAML / Trust Relationships, and "Add Relationship":</p>
<p><img alt="image" src="../../img/admin-guide/plugin/minnow-saml-trust-relationship-shibboleth-sp.png" /></p>
<p>Then, configure for SAML2SSO profile. Click on the checkbox to
"Configure specific RelyingParty":</p>
<p><img alt="image" src="../../img/admin-guide/plugin/configure_rp.png" /></p>
<p>Then, click to add the SAML2SSO profile:</p>
<p><img alt="image" src="../../img/admin-guide/plugin/saml_sso-profile.png" /></p>
<p>Then "Save" and "Update." Wait 5 minutes for the Shibboleth IDP to detect reload the metadata or
stop and start tomcat.</p>
<h3 id="test">Test<a class="headerlink" href="#test" title="Permanent link">#</a></h3>
<p>Test the CGI script at <code>https://minnow.gluu.info/protected/printHeaders.py</code>.
Enter both the valid username and password (like <code>admin</code> and your
initial admin password). The output will contain something like this:</p>
<pre><code>**Environment Variables**

AUTH_TYPE: shibboleth
CONTEXT_DOCUMENT_ROOT: /var/www/protected/
CONTEXT_PREFIX: /protected/
DOCUMENT_ROOT: /var/www/html
GATEWAY_INTERFACE: CGI/1.1
HTTPS: on
HTTP_ACCEPT: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
HTTP_ACCEPT_ENCODING: gzip, deflate, sdch
HTTP_ACCEPT_LANGUAGE: en-US,en;q=0.8
HTTP_CONNECTION: keep-alive
HTTP_COOKIE: _shibsession_64656661756c7468747470733a2f2f6d696e6e6f772e676c75752e696e666f2f73686962626f6c657468=_6aab7e287072bcc123989d8bf5f0ed5e
HTTP_DNT: 1
HTTP_HOST: minnow.gluu.info
HTTP_UPGRADE_INSECURE_REQUESTS: 1
HTTP_USER_AGENT: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.85 Safari/537.36
PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
QUERY_STRING:
REMOTE_ADDR: 192.168.88.1
REMOTE_PORT: 52140
REMOTE_USER: mike
REQUEST_METHOD: GET
REQUEST_SCHEME: https
REQUEST_URI: /protected/printHeaders.py
SCRIPT_FILENAME: /var/www/protected/printHeaders.py
SCRIPT_NAME: /protected/printHeaders.py
SERVER_ADDR: 192.168.88.133
SERVER_ADMIN: webmaster@localhost
SERVER_NAME: minnow.gluu.info
SERVER_PORT: 443
SERVER_PROTOCOL: HTTP/1.1
SERVER_SIGNATURE:
Apache/2.4.7 (Ubuntu) Server at minnow.gluu.info Port 443
SERVER_SOFTWARE: Apache/2.4.7 (Ubuntu)
SHIB_Shib_Application_ID: default
SHIB_Shib_Authentication_Instant: 2015-09-17T01:13:23.278Z
SHIB_Shib_Authentication_Method: urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
SHIB_Shib_AuthnContext_Class: urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
SHIB_Shib_Identity_Provider: https://brookie.gluu.info/idp/shibboleth
SHIB_Shib_Session_ID: _6aab7e287072bcc123989d8bf5f0ed5e
SHIB_Shib_Session_Index: _40e4b17668a13e0d406e41cc9f6bf116
SHIB_displayName: Mike Schwartz
SHIB_givenName: Michael
SHIB_mail: mike@gmail.com
SHIB_sn: Schwartz
SHIB_uid: mike
SSL_CIPHER: ECDHE-RSA-AES128-GCM-SHA256
SSL_CIPHER_ALGKEYSIZE: 128
SSL_CIPHER_EXPORT: false
SSL_CIPHER_USEKEYSIZE: 128
SSL_CLIENT_VERIFY: NONE
SSL_COMPRESS_METHOD: NULL
SSL_PROTOCOL: TLSv1.2
SSL_SECURE_RENEG: true
SSL_SERVER_A_KEY: rsaEncryption
SSL_SERVER_A_SIG: sha256WithRSAEncryption
SSL_SERVER_I_DN: emailAddress=mike@gluu.org,CN=minnow.gluu.info,O=Gluu,L=Austin,ST=TX,C=US
SSL_SERVER_I_DN_C: US
SSL_SERVER_I_DN_CN: minnow.gluu.info
SSL_SERVER_I_DN_Email: mike@gmail.com
SSL_SERVER_I_DN_L: Austin
SSL_SERVER_I_DN_O: Gluu
SSL_SERVER_I_DN_ST: TX
SSL_SERVER_M_SERIAL: 9F5E4F891590BB53
SSL_SERVER_M_VERSION: 1
SSL_SERVER_S_DN: emailAddress=mike@gluu.org,CN=minnow.gluu.info,O=Gluu,L=Austin,ST=TX,C=US
SSL_SERVER_S_DN_C: US
SSL_SERVER_S_DN_CN: minnow.gluu.info
SSL_SERVER_S_DN_Email: mike@gmail.com
SSL_SERVER_S_DN_L: Austin
SSL_SERVER_S_DN_O: Gluu
SSL_SERVER_S_DN_ST: TX
SSL_SERVER_V_END: Sep 10 18:46:32 2016 GMT
SSL_SERVER_V_START: Sep 11 18:46:32 2015 GMT
SSL_SESSION_RESUMED: Initial
SSL_TLS_SNI: minnow.gluu.info
SSL_VERSION_INTERFACE: mod_ssl/2.4.7
SSL_VERSION_LIBRARY: OpenSSL/1.0.1f
</code></pre>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">#</a></h2>
<ul>
<li>
<p>Make sure you update your hosts file on the Gluu Server, Apache
   server, and your workstation--this won't work with IP addresses,
   only.</p>
</li>
<li>
<p>Check the Shibboleth log file <code>/opt/idp/logs/idp-process.log</code> if you
   don't see the headers or REMOTE_USER environment variables. Also,
   restart the Apache Tomcat service by <code>service tomcat restart</code> to 
   make sure the new Shibboleth IDP xml files were loaded.</p>
</li>
<li>
<p>Clear the cookies in your web browser for both the Apache site, and 
   the Gluu Server if you are logging in and logging out a lot with 
   lots of server restarts.</p>
</li>
</ul>
<h2 id="iis-saml-configuration">IIS SAML Configuration<a class="headerlink" href="#iis-saml-configuration" title="Permanent link">#</a></h2>
<h3 id="iis-configuration-in-windows-7">IIS Configuration in Windows 7<a class="headerlink" href="#iis-configuration-in-windows-7" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Start --&gt; Control Panel --&gt; Programs --&gt; "Turn Windows features on or off"</p>
</li>
<li>
<p>Select (i) IIS (ii) Web Management Tools (iii) II6 Management Compatibility (iv) IIS Management Console (v) IIS Management Scripts and Tools (vi) IIS Management Service</p>
</li>
<li>
<p>Select (i) World Wide Web Services (ii) CGI (iii) ISAPI Filters (iv) ISAPI Extensions --&gt; Press OK.
<img alt="IIS 7 Setup" src="../../img/admin-guide/plugin/admin_sp_iis7setup.png" /></p>
</li>
<li>
<p>Test IIS to see if it is installed in your system with "127.0.0.1" in the web browser. For our test case, we used IIS7.
<img alt="Test IIS" src="../../img/admin-guide/plugin/admin_sp_iis7test.png" /></p>
</li>
</ol>
<h3 id="isapi-filter-configuration">ISAPI Filter Configuration<a class="headerlink" href="#isapi-filter-configuration" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Open IIS Manager (Start --&gt; Administrative Tools --&gt; Internet Information Service/IIS Manager)</p>
</li>
<li>
<p>Double click on "ISAPI and CGI Restrictions"
<img alt="ISAPI and CGI" src="../../img/admin-guide/plugin/admin_sp_isapicgi.png" /></p>
</li>
<li>
<p>Add a new Filter</p>
</li>
</ol>
<p>a. Click Actions --&gt; Add (upper right corner)</p>
<p>b. Select "\opt\shibboleth-sp\lib\shibboleth\isapi_shib.dll"</p>
<p>c. Description: "Shibboleth"</p>
<p>d. Click "Allow" (from the right hand side)</p>
<p><img alt="ISAPI Path" src="../../img/admin-guide/plugin/apache_sp_isapipath.png" /></p>
<p>e. Back to IIS Manager --&gt; ISAPI Filters</p>
<p><img alt="ISAPI Filters" src="../../img/admin-guide/plugin/apache_sp_isapifilter.png" /></p>
<pre><code>    1. Click "Add" (upper right corner)

    2. Filter Name: Shibboleth

    3. Executable: "\opt\shibboleth-sp\lib\shibboleth\isapi_shib.dll"
</code></pre>
<p><img alt="ISAPI Edit" src="../../img/admin-guide/plugin/apache_sp_isapiedit.png" /></p>
<p>f. SSO file extension mapping</p>
<pre><code>    1. Click on "Handler Mapping" from main page
</code></pre>
<p><img alt="SP Handler" src="../../img/admin-guide/plugin/admin_sp_handlermapping.png" /></p>
<pre><code>    2. Click "Add Script Map" from Action
</code></pre>
<p><img alt="Script Map" src="../../img/admin-guide/plugin/admin_sp_addscriptmap.png" /></p>
<pre><code>    3. Request Path :".sso"

    4. Executable should be pointed to "isapi_shib.dll"
</code></pre>
<p><img alt="Executable" src="../../img/admin-guide/plugin/admin_sp_executable.png" /></p>
<p>g. Restart IIS</p>
<p>h. Check Status</p>
<p>Check Status by typing in "http://127.0.0.1/Shibboleth.sso/Status" in the web browser. If it displays an XML document, then the Shibboleth SP Installation in Windows IIS7 in complete.
<img alt="Status Check" src="../../img/admin-guide/plugin/admin_sp_checkstatus.png" /></p>
<h2 id="shibboleth-sp-setup-in-windows-2008-r2-with-iis7">Shibboleth SP Setup in Windows 2008 R2 with IIS7<a class="headerlink" href="#shibboleth-sp-setup-in-windows-2008-r2-with-iis7" title="Permanent link">#</a></h2>
<ol>
<li>Open up "Server Manager", scroll down and click on "Add Roles".</li>
</ol>
<p><img alt="Add Role" src="../../img/admin-guide/plugin/iis_setup_addrole.png" /></p>
<ol>
<li>Hit "Next"</li>
</ol>
<p><img alt="Next" src="../../img/admin-guide/plugin/iis_setup_next.png" /></p>
<ol>
<li>Select "Web Server (IIS)", hit "Next"</li>
</ol>
<p><img alt="Web Server" src="../../img/admin-guide/plugin/iis_setup_webserver.png" /></p>
<ol>
<li>Select (i) CGI</li>
</ol>
<p>(ii) ISAPI Extensions</p>
<p>(iii) ISAPI Filters</p>
<p>(iv) Management Tools</p>
<p>(a) IIS Management Console</p>
<p>(b) IIS Management Scripts and Tools</p>
<p>(c) Management Service</p>
<p>(v) All IIS6 Management Compatibility</p>
<p><img alt="Selection" src="../../img/admin-guide/plugin/iis_setup_selection.png" /></p>
<p><img alt="Selection" src="../../img/admin-guide/plugin/iis_setup_selection1.png" /></p>
<ol>
<li>Hit "Next", for the confirmation, check the list of plugins.</li>
</ol>
<p><img alt="Plugin" src="../../img/admin-guide/plugin/iis_setup_plugin.png" /></p>
<p><img alt="Management Tools" src="../../img/admin-guide/plugin/iis_setup_managementtools.png" /></p>
<ol>
<li>Hit "Install" and Windows 2008 will complete the installation. A confirmation window shall appear which resembles the screenshot below.</li>
</ol>
<p><img alt="Confirmation" src="../../img/admin-guide/plugin/iis_setup_confirmation.png" /></p>
<p>7.Test IIS7 setup from the Internet.</p>
<p><img alt="Test" src="../../img/admin-guide/plugin/iis_setup_test.png" /></p>
<h3 id="shibboleth-sp-25x-setup">Shibboleth SP 2.5.x Setup<a class="headerlink" href="#shibboleth-sp-25x-setup" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Down the <a href="http://www.shibboleth.net/downloads/service-provider/latest/">Shibboleth SP 2.5.x</a></p>
</li>
<li>
<p>Start the installation, keep the default path, Select "Install ISAPI modules into IIS", IIS Script Extension must be ".sso" and Hit "Next".</p>
</li>
</ol>
<p><img alt="Shib Setup" src="../../img/admin-guide/plugin/iis_setup_shibsetup.png" /></p>
<ol>
<li>After the completion of the installation, the system will ask to reboot the system; hit "Yes".</li>
</ol>
<p><img alt="Restart" src="../../img/admin-guide/plugin/iis_setup_restart.png" /></p>
<ol>
<li>Test the Shibboleth SP installation from the SP VM using the URL "localhost/Shibboleth.sso/Status" in the address bar of the Web Browser.</li>
</ol>
<p><img alt="Status" src="../../img/admin-guide/plugin/iis_setup_status.png" /></p>
<h3 id="trust-relationship-in-idp">Trust Relationship in IdP<a class="headerlink" href="#trust-relationship-in-idp" title="Permanent link">#</a></h3>
<ol>
<li>Create a Trust Relationship for the new SP in the IdP. It is necessary to upload the Public Certificate of the new SP in the IdP. Please note that the CN of the public certificate MUST BE the same as <em>Hostname</em> of the SP. Hit "Add".</li>
</ol>
<p><img alt="Add TR" src="../../img/admin-guide/plugin/iis_setup_addtr.png" /></p>
<ol>
<li>Download the IdP generated configuration files for Shib SP modification.</li>
</ol>
<p><img alt="Download" src="../../img/admin-guide/plugin/iis_setup_download.png" /></p>
<h3 id="sp-configuration">SP Configuration<a class="headerlink" href="#sp-configuration" title="Permanent link">#</a></h3>
<ol>
<li>
<p>The files from the IdP must be placed in the SP Configuration.</p>
</li>
<li>
<p>Before placing them inside the SP Configuration please check</p>
</li>
</ol>
<p>(a) The "spcert.crt" file has the CN same as the SP hostname.</p>
<p>(b) The "spcert.crt" and "spkey.key" has the same <em>md5sum</em> value.</p>
<p>(c) The IdP-metadata is perfectly placed inside the SP Configuration.</p>
<p>(d) The downloaded "shibboleth2.xml" file has values resembling the file content below.</p>
<ol>
<li>For testing purpose, we are going to protect a directory named "secure" with the IdP.  Create a folder/directory in the IIS Root Directory and restart Shibd and IIS.</li>
</ol>
<p><img alt="Secure" src="../../img/admin-guide/plugin/iis_setup_secure.png" /></p>
<h3 id="sso-testing">SSO Testing<a class="headerlink" href="#sso-testing" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Place the following URL in the web browser: "https://SP_Name/secure"</p>
</li>
<li>
<p>It will redirect the user to the IdP for authentication.</p>
</li>
<li>
<p>After the authentication is complete, the user will be shown the protected page. For this case, the page is the IIS7 index page.</p>
<p><SPConfig xmlns="urn:mace:shibboleth:2.0:native:sp:config"
      xmlns:conf="urn:mace:shibboleth:2.0:native:sp:config"
      xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
      xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"  <br />      xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata"
      logger="syslog.logger" clockSkew="180"></p>
<p><!-- The OutOfProcess section contains properties affecting the shibd daemon. -->
      <OutOfProcess logger="shibd.logger">
      </OutOfProcess></p>
<p><!-- The InProcess section conrains settings affecting web server modules/filters. -->
      <InProcess logger="native.logger">
        <ISAPI normalizeRequest="true" safeHeaderNames="true">
              <Site id="1" name="SP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS"/>
        </ISAPI>
      </InProcess></p>
<p><!-- Only one listener can be defined, to connect in-process modules to shibd. -->
      <TCPListener address="127.0.0.1" port="1600" acl="127.0.0.1"/>
      <!-- <UnixListener address="shibd.sock"/> --></p>
<p><!-- This set of components stores sessions and other persistent data in daemon memory. -->
      <StorageService type="Memory" id="mem" cleanupInterval="900"/>
      <SessionCache type="StorageService" StorageService="mem" cacheTimeout="3600" inprocTimeout="900" cleanupInterval="900"/>
      <ReplayCache StorageService="mem"/>
      <ArtifactMap artifactTTL="180"/></p>
<p><!-- To customize behavior, map hostnames and path components to applicationId and other settings. -->
      <RequestMapper type="Native">
        <RequestMap applicationId="default">
                <Host name="SP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS">
                <Path name="secure" authType="shibboleth" requireSession="true"/>
                </Host>
        </RequestMap>
      </RequestMapper></p>
<p><!--
      The ApplicationDefaults element is where most of Shibboleths SAML bits are defined.
      Resource requests are mapped by the RequestMapper to an applicationId that
      points into to this section.
      -->
  <ApplicationDefaults id="default" policyId="default"
        entityID="DAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx867"
        REMOTE_USER="eppn persistent-id targeted-id uid mail"
        signing="false" encryption="false" attributePrefix="AJP_"></p>
<pre><code>&lt;!--
    Controls session lifetimes, address checks, cookie handling, and the protocol handlers.
    You MUST supply an effectively unique handlerURL value for each of your applications.
    The value can be a relative path, a URL with no hostname (https:///path) or a full URL.
    The system can compute a relative value based on the virtual host. Using handlerSSL="true"
    will force the protocol to be https. You should also add a cookieProps setting of "; path=/; secure"
    in that case. Note that while we default checkAddress to "false", this has a negative
    impact on the security of the SP. Stealing cookies/sessions is much easier with this disabled.
    --&gt;
&lt;Sessions lifetime="28800" timeout="3600" checkAddress="false"
            handlerURL="https://SP_HOSTNAME/Shibboleth.sso" handlerSSL="false"
            exportLocation="http://localhost/Shibboleth.sso/GetAssertion" exportACL="127.0.0.1"
            idpHistory="false" idpHistoryDays="7" cookieProps="; path=/; secure; httpOnly"&gt;

    &lt;!--
            SessionInitiators handle session requests and relay them to a Discovery page,
            or to an IdP if possible. Automatic session setup will use the default or first
            element (or requireSessionWith can specify a specific id to use).
            --&gt;

    &lt;!-- Default example directs to a specific IdPs SSO service (favoring SAML 2 over Shib 1). --&gt;
            &lt;SessionInitiator type="Chaining" Location="/Login" isDefault="true" id="gluu"
                    relayState="cookie" entityID="https://IDP_HOSTNAME/idp/shibboleth"&gt;
               &lt;SessionInitiator type="SAML2" acsIndex="1" template="bindingTemplate.html"/&gt;
               &lt;SessionInitiator type="Shib1" acsIndex="5"/&gt;
            &lt;/SessionInitiator&gt;

    &lt;!--
            md:AssertionConsumerService locations handle specific SSO protocol bindings,
            such as SAML 2.0 POST or SAML 1.1 Artifact. The isDefault and index attributes
            are used when sessions are initiated to determine how to tell the IdP where and
            how to return the response.
            --&gt;
    &lt;md:AssertionConsumerService Location="/SAML2/POST" index="1"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
            &lt;md:AssertionConsumerService Location="/SAML2/POST-SimpleSign" index="2"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST-SimpleSign"/&gt;
            &lt;md:AssertionConsumerService Location="/SAML2/Artifact" index="3"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;
            &lt;md:AssertionConsumerService Location="/SAML2/ECP" index="4"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:PAOS"/&gt;
            &lt;md:AssertionConsumerService Location="/SAML/POST" index="5"
            Binding="urn:oasis:names:tc:SAML:1.0:profiles:browser-post"/&gt;
            &lt;md:AssertionConsumerService Location="/SAML/Artifact" index="6"
            Binding="urn:oasis:names:tc:SAML:1.0:profiles:artifact-01"/&gt;

    &lt;!-- LogoutInitiators enable SP-initiated local or global/single logout of sessions. --&gt;
            &lt;LogoutInitiator type="Chaining" Location="/Logout" relayState="cookie"&gt;
            &lt;LogoutInitiator type="SAML2" template="bindingTemplate.html"/&gt;
            &lt;LogoutInitiator type="Local"/&gt;
            &lt;/LogoutInitiator&gt;

    &lt;!-- md:SingleLogoutService locations handle single logout (SLO) protocol messages. --&gt;
            &lt;md:SingleLogoutService Location="/SLO/SOAP"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;
            &lt;md:SingleLogoutService Location="/SLO/Redirect" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"/&gt;
            &lt;md:SingleLogoutService Location="/SLO/POST" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
            &lt;md:SingleLogoutService Location="/SLO/Artifact" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;

    &lt;!-- md:ManageNameIDService locations handle NameID management (NIM) protocol messages. --&gt;
            &lt;md:ManageNameIDService Location="/NIM/SOAP"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;
            &lt;md:ManageNameIDService Location="/NIM/Redirect" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"/&gt;
            &lt;md:ManageNameIDService Location="/NIM/POST" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
            &lt;md:ManageNameIDService Location="/NIM/Artifact" conf:template="bindingTemplate.html"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;

    &lt;!--
            md:ArtifactResolutionService locations resolve artifacts issued when using the
            SAML 2.0 HTTP-Artifact binding on outgoing messages, generally uses SOAP.
            --&gt;
            &lt;md:ArtifactResolutionService Location="/Artifact/SOAP" index="1"
            Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;

    &lt;!-- Extension service that generates "approximate" metadata based on SP configuration. --&gt;
            &lt;Handler type="MetadataGenerator" Location="/Metadata" signing="false"/&gt;

            &lt;!-- Status reporting service. --&gt;
            &lt;Handler type="Status" Location="/Status" acl="127.0.0.1"/&gt;

            &lt;!-- Session diagnostic service. --&gt;
            &lt;Handler type="Session" Location="/Session" showAttributeValues="false"/&gt;

&lt;/Sessions&gt;

&lt;!--
    Allows overriding of error template filenames. You can also add attributes with values
    that can be plugged into the templates.
    --&gt;
    &lt;Errors supportContact="support@gluu.org"
            logoLocation="/shibboleth-sp/logo.jpg"
            styleSheet="/shibboleth-sp/main.css"/&gt;

&lt;!-- Uncomment and modify to tweak settings for specific IdPs or groups. --&gt;
    &lt;RelyingParty Name="IDP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS" keyName="IDP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS"/&gt;

&lt;!-- Chains together all your metadata sources. --&gt;
    &lt;MetadataProvider type="Chaining"&gt;
    &lt;MetadataProvider type="XML" file="C:\opt\shibboleth-sp\etc\shibboleth\idp-metadata.xml"/&gt;
    &lt;/MetadataProvider&gt;

&lt;!-- Chain the two built-in trust engines together. --&gt;
    &lt;TrustEngine type="Chaining"&gt;
            &lt;TrustEngine type="ExplicitKey"/&gt;
            &lt;TrustEngine type="PKIX"/&gt;
    &lt;/TrustEngine&gt;

&lt;!-- Map to extract attributes from SAML assertions. --&gt;
    &lt;AttributeExtractor type="XML" validate="true" path="attribute-map.xml"/&gt;

    &lt;!-- Use a SAML query if no attributes are supplied during SSO. --&gt;
    &lt;AttributeResolver type="Query" subjectMatch="true"/&gt;

    &lt;!-- Default filtering policy for recognized attributes, lets other data pass. --&gt;
    &lt;AttributeFilter type="XML" validate="true" path="attribute-policy.xml"/&gt;

&lt;!-- Simple file-based resolver for using a single keypair. --&gt;
    &lt;!-- &lt;CredentialResolver type="File" key="sp-key.pem" certificate="sp-cert.pem"/&gt; --&gt;

    &lt;!-- TODO is password needed? --&gt;
    &lt;CredentialResolver type="File" key="C:\opt\shibboleth-sp\etc\shibboleth\spkey.key"
                    certificate="C:\opt\shibboleth-sp\etc\shibboleth\spcert.crt" /&gt;

&lt;/ApplicationDefaults&gt;

&lt;!-- Each policy defines a set of rules to use to secure messages. --&gt;
    &lt;SecurityPolicies&gt;
    &lt;!--
    The predefined policy enforces replay/freshness, standard
    condition processing, and permits signing and client TLS.
    --&gt;
&lt;Policy id="default" validate="false"&gt;
            &lt;PolicyRule type="MessageFlow" checkReplay="true" expires="60"/&gt;
            &lt;PolicyRule type="Conditions"&gt;
                &lt;PolicyRule type="Audience"/&gt;
                &lt;!-- Enable Delegation rule to permit delegated access. --&gt;
                &lt;!-- &lt;PolicyRule type="Delegation"/&gt; --&gt;
            &lt;/PolicyRule&gt;
            &lt;PolicyRule type="ClientCertAuth" errorFatal="true"/&gt;
            &lt;PolicyRule type="XMLSigning" errorFatal="true"/&gt;
            &lt;PolicyRule type="SimpleSigning" errorFatal="true"/&gt;
    &lt;/Policy&gt;
    &lt;/SecurityPolicies&gt;
</code></pre>
<p></SPConfig></p>
</li>
</ol>
<h2 id="configuring-apache-shibboleth-sp-in-windows">Configuring Apache Shibboleth SP in Windows<a class="headerlink" href="#configuring-apache-shibboleth-sp-in-windows" title="Permanent link">#</a></h2>
<h3 id="shibboleth-sp-installation_1">Shibboleth SP Installation<a class="headerlink" href="#shibboleth-sp-installation_1" title="Permanent link">#</a></h3>
<ol>
<li>
<p>Download the MSI of Shibboleth-SP from:
   http://www.shibboleth.net/downloads/service-provider/latest/ .</p>
</li>
<li>
<p>Start the installation</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_click.png" /></p>
</li>
<li>
<p>Define the destination folder (by default it is: C:\opt\shibboleth-sp).</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_destination.png" /></p>
</li>
<li>
<p>Select the Shibboleth Daemon port. By default it is 1600, and you may
   keep it for testing it, locally.</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_port.png" /></p>
</li>
<li>
<p>Now, there are two options. According to your target you will have to
choose one.</p>
<ol>
<li>
<p>Option 1: If you install Shibboleth for the Apache Web Server</p>
</li>
<li>
<p>Option 2: If you install Shibboleth for Microsoft IIS Web Server</p>
<p>a. For the Microsoft IIS Web Server, CHECK "Install ISAPI filter and configure IIS". Remember to put the fie Extension ".sso" is necessary.</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_microsoft.png" /></p>
<p>b. For the Apache Web Server, UNCHECK "Install ISAPI filter and configure IIS".</p>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_apachesetup.png" /></p>
</li>
<li>
<p>UAC of Windows 7 may block this program, so allow it.</p>
</li>
</ol>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_uac.png" /></p>
</li>
</ol>
<h3 id="apache-configuration">Apache Configuration<a class="headerlink" href="#apache-configuration" title="Permanent link">#</a></h3>
<pre><code>1. Download the Apache HTTP server MSI Installer with OpenSSL:
   http://httpd.apache.org/download.cgi#apache22 .

![IMAGE](/img/admin-guide/plugin/admin_sp_apacheclick.png)

2. Select the destination. You can keep the default destination for your local testing. But, make sure that there is no other "Apache Software Foundation" directory in your current "C:\Program Files\" location.

![IMAGE](/img/admin-guide/plugin/admin_sp_apachedestination.png)

3. Provide the Server Information. For local testing you can use
   `localdomain/localhost`.

![IMAGE](/img/admin-guide/plugin/admin_sp_serverinfo.png)

4. Test whether the Apache web server is installed or not. Open your web
browser and use `localhost`. If you see something like the image shown
below--you are done!
</code></pre>
<p><img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_apachetest.png" /></p>
<h4 id="shibboleth-and-apache-configuration">Shibboleth and Apache Configuration<a class="headerlink" href="#shibboleth-and-apache-configuration" title="Permanent link">#</a></h4>
<ol>
<li>Change the permission of the Apache installation directory, and
   provide "write" access.</li>
<li>
<p><code>httpd.conf</code> configuration</p>
<ol>
<li>
<p>Change "ServerName localhost:80" (for your local testing)</p>
</li>
<li>
<p>Copy <code>apache22.conf</code> from the Shibboleth directory to <code>~/apache/conf/extra/</code></p>
</li>
</ol>
</li>
<li>
<p><code>Shibboleth2.xml</code> configuration</p>
<ol>
<li>
<p>Change: Host name="localhost" (for local testing)</p>
</li>
<li>
<p>Change: entityID="https://localhost/shibboleth" (for local testing)</p>
</li>
<li>
<p>Change: ApplicationOverride id="admin" entityID="https://localhost/shibboleth/"</p>
</li>
</ol>
</li>
<li>
<p>Reboot your windows machine.</p>
</li>
</ol>
<h3 id="test-sp-installation-with-windows-and-apache">Test SP Installation with Windows and Apache<a class="headerlink" href="#test-sp-installation-with-windows-and-apache" title="Permanent link">#</a></h3>
<ol>
<li>Open the web browser, and provide the address:
   <code>localhost/Shibboleth.sso/Status</code></li>
<li>If you can see some XML page like the one shown below--you are done
   with your SP installation in Windows through Apache2.</li>
</ol>
<p>a<img alt="IMAGE" src="../../img/admin-guide/plugin/admin_sp_checkstatus.png" /></p>
          <aside class="copyright" role="note">
           Built with 
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a> using
            <a href="http://gitlab.testbird.io:8099/frontend/testbird-mkdocs-theme.git" target="_blank">
              testBird-mkdocs-theme
            </a> <br>
            
            Copyright &copy; 2016, Gluu, Inc.
            
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../integrate/" title="Service Integration in Gluu CE">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Service Integration in Gluu CE
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../backup/" title="Backup Gluu Server CE">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Backup Gluu Server CE
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-ce3999cf34.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    
  </body>
</html>